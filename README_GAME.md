# ポーカーゲーム仕様書

## 概要
iPhone専用のテキサスホールデムポーカーWebアプリ。WebRTC P2P通信により、サーバー代0円で動作。

## 技術スタック
- **フロントエンド**: HTML5, CSS, JavaScript (ES6)
- **通信**: WebRTC DataChannel (P2P)
- **シグナリング**: Firebase Realtime Database
- **ホスティング**: GitHub Pages
- **対応環境**: iPhone Safari

## ゲームルール

### 基本仕様
- **プレイ人数**: 2〜7人
- **ゲーム形式**: テキサスホールデム
- **チップ**: 仮想チップのみ（現金・換金要素なし）
- **ホスト方式**: ホストがゲームロジックを管理、プレイヤーとしても参加可能

### ゲーム設定
- **バイイン**: 初期チップ数（デフォルト: 1000）
- **スモールブラインド (SB)**: デフォルト 10
- **ビッグブラインド (BB)**: デフォルト 20
- **ブラインド変更**: ホストがゲーム中に変更可能

## ゲームフロー

### 1. ルーム作成・参加
1. ホストが名前と設定を入力してルーム作成
2. ルームIDが表示される
3. 他のプレイヤーはルームIDと名前を入力して参加
4. ホストが「ゲーム開始」ボタンを押す

### 2. ハンド開始
1. ディーラーボタン (D) が設定される
2. SBとBBが自動徴収される
3. 各プレイヤーに2枚の手札が配られる
4. プリフロップのベッティングラウンド開始

### 3. ベッティングラウンド

#### フェーズ
1. **PREFLOP**: 手札2枚のみ
2. **FLOP**: コミュニティカード3枚公開
3. **TURN**: コミュニティカード4枚目公開
4. **RIVER**: コミュニティカード5枚目公開
5. **SHOWDOWN**: 役判定と勝者決定

#### アクション
- **フォールド**: 降りる（赤色タグ）
- **チェック**: ベットなしでパス（緑色タグ）
- **コール**: 現在のベット額に合わせる（黄色タグ）
- **ベット/レイズ**: チップを賭ける（オレンジ色タグ）
- **オールイン**: 全チップを賭ける（赤色タグ）

#### レイズUI
- **スライダー**: 最小レイズ額〜オールインまで調整可能
- **プリセットボタン**:
  - ミニマム: 最小レイズ額（現在のベット×2）
  - ポット: ポット額 + コール額
  - オールイン: 全チップ

### 4. ポット管理
- ベット時は各プレイヤーの`bet`に保持
- フェーズ終了時に全員のベットをポットに移動
- 画面表示:
  - **ポット**: 確定した金額
  - **現在のベット**: 今のラウンドの賭け額（グレー）
  - **合計**: ポット + 現在のベット（黄色）

### 5. オールイン処理
- オールインしたプレイヤーはターンをスキップ
- アクション可能なプレイヤーが1人以下になったら自動的に次フェーズへ
- オールインプレイヤーも勝敗判定に参加

### 6. 勝敗判定

#### 役の強さ（強い順）
1. ストレートフラッシュ
2. フォーカード
3. フルハウス
4. フラッシュ
5. ストレート
6. スリーカード
7. ツーペア
8. ワンペア
9. ハイカード

#### 勝利パターン
- **フォールドで勝利 (WINNER)**: 手札非公開、勝者名と獲得額のみ表示
- **ショウダウン (SHOWDOWN)**: 全員の手札公開、役名と勝者を表示

### 7. 次のハンド
- 全プレイヤーが「次のハンドへ」ボタンを押す
- 準備完了人数を表示（例: 2/3）
- 全員が押したら自動的に次のハンドへ
- ディーラーボタンが次のプレイヤーに移動

### 8. ゲーム終了
- プレイヤーが2人未満になったらゲーム終了
- 優勝者と最終チップ数を表示
- ホストが「新しいゲームを開始」ボタンで再開可能
- 再開時は脱落したプレイヤーも全員復活（チップリセット）

## UI仕様

### カード表示
- **スート**: ♠(黒) ♥(赤) ♦(青) ♣(緑)
- **ランク**: 2-9, T(10), J, Q, K, A
- 白背景、大きめサイズ、影付き

### プレイヤー表示
- **通常**: グレー背景
- **自分のターン**: 青背景
- **フォールド**: 暗い背景、透明度50%、グレー枠
- **アクションタグ**: 最後のアクションを色付きタグで表示
- **ディーラーボタン**: (D) マーク

### ランキング表示
- チップ数で降順ソート
- 1位🥇、2位🥈、3位🥉
- 4位以降は数字で表示
- ハンドごとに自動更新

### 勝者表示
- 👑マーク
- 金色の枠
- 緑色の背景
- 役名表示
- 獲得チップを+表示（緑色）

## 通信仕様

### メッセージタイプ
- `join`: プレイヤー参加
- `state`: ゲーム状態同期
- `blinds`: ブラインド更新
- `game_start`: ゲーム開始
- `game_update`: ゲーム状態更新
- `action`: プレイヤーアクション
- `ready_next_hand`: 次のハンド準備完了
- `game_over`: ゲーム終了
- `game_restart`: ゲーム再開

### データフロー
1. クライアント → ホスト: アクション送信
2. ホスト: ゲームロジック処理
3. ホスト → 全クライアント: 状態ブロードキャスト
4. 全員: 画面更新

## セキュリティ

### Firebase設定
- Realtime Databaseはシグナリングのみ使用
- ゲームデータはP2P通信で直接やり取り
- 1時間以上古いルームデータは書き込み不可

### 制約
- 完全オフライン不可
- TURNサーバ未使用（一部環境で接続不可の可能性）
- 切断時はゲーム継続不可

## 注意事項
- 娯楽目的のみ
- 金銭・換金・外部価値なし
- 賭博行為には使用しないこと
- マンションWi-Fi等の端末分離環境では動作しない場合あり

## 今後の拡張案
- サイドポット対応（複数オールイン時）
- リバイ/アドオン機能
- 観戦モード
- ゲーム履歴記録
- 統計情報表示
- カスタムブラインド構造
